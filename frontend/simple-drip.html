<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D.R.I.P. - Simple Payment System</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <span>ðŸ’§ D.R.I.P.</span>
            </div>
            <div class="nav-links">
                <a href="#marketplace" class="nav-link active">Marketplace</a>
                <a href="#upload" class="nav-link">Upload</a>
                <a href="#dashboard" class="nav-link">Dashboard</a>
            </div>
            <div class="nav-actions">
                <div class="wallet-connect" id="wallet-connect">
                    <button id="connect-wallet-btn" class="btn btn-primary">
                        <i class="fas fa-wallet"></i>
                        <span>Connect Wallet</span>
                    </button>
                </div>
                <div class="wallet-info" id="wallet-info" style="display: none;">
                    <div class="wallet-details">
                        <span id="wallet-address">Not Connected</span>
                        <span id="wallet-balance">0 BNB</span>
                    </div>
                    <button id="disconnect-wallet" class="btn btn-outline btn-sm">Disconnect</button>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1 class="hero-title">
                    <span class="gradient-text">D.R.I.P.</span><br>
                    Simple Payment System
                </h1>
                <p class="hero-description">
                    Upload, share, and monetize your content. Users pay you, you pay creators. 
                    No smart contracts needed - just MetaMask!
                </p>
                <div class="hero-stats">
                    <div class="stat">
                        <span class="stat-number" id="total-content">0</span>
                        <span class="stat-label">Content</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number" id="total-revenue">0</span>
                        <span class="stat-label">Revenue (USDC)</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number" id="platform-fee">5%</span>
                        <span class="stat-label">Platform Fee</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Marketplace -->
        <section id="marketplace" class="section">
            <div class="section-header">
                <h2>Content Marketplace</h2>
                <p>Discover and purchase content</p>
            </div>
            <div class="content-grid" id="content-grid">
                <!-- Content will be loaded here -->
            </div>
        </section>

        <!-- Upload Section -->
        <section id="upload" class="section" style="display: none;">
            <div class="section-header">
                <h2>Upload Content</h2>
                <p>Share your content and start earning</p>
            </div>
            <div class="upload-container">
                <form id="upload-form" class="upload-form">
                    <div class="form-section">
                        <h3>Content Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="content-title-input">Title *</label>
                                <input type="text" id="content-title-input" required placeholder="Enter content title">
                            </div>
                            <div class="form-group">
                                <label for="content-type-select">Content Type *</label>
                                <select id="content-type-select" required>
                                    <option value="video">Video</option>
                                    <option value="image">Image</option>
                                    <option value="audio">Audio</option>
                                    <option value="document">Document</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="content-description-input">Description *</label>
                            <textarea id="content-description-input" rows="4" required placeholder="Describe your content..."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Pricing</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="view-price-input">View Price (USDC) *</label>
                                <input type="number" id="view-price-input" min="0" step="0.1" required placeholder="0.1">
                                <small>Price for one-time viewing</small>
                            </div>
                            <div class="form-group">
                                <label for="ownership-price-input">Ownership Price (USDC) *</label>
                                <input type="number" id="ownership-price-input" min="0" step="0.1" required placeholder="1.0">
                                <small>Price for permanent ownership</small>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" id="submit-upload" class="btn btn-primary">
                            <i class="fas fa-upload"></i>
                            Upload Content
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Dashboard -->
        <section id="dashboard" class="section" style="display: none;">
            <div class="section-header">
                <h2>Your Dashboard</h2>
                <p>Manage your content and earnings</p>
            </div>
            <div class="dashboard-stats">
                <div class="stat-card">
                    <h3>Platform Revenue</h3>
                    <span class="stat-value" id="platform-revenue">0 USDC</span>
                </div>
                <div class="stat-card">
                    <h3>Paid to Creators</h3>
                    <span class="stat-value" id="paid-creators">0 USDC</span>
                </div>
                <div class="stat-card">
                    <h3>Pending Payments</h3>
                    <span class="stat-value" id="pending-payments">0</span>
                </div>
            </div>
        </section>

        <!-- Content Viewer Modal -->
        <div id="content-viewer-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="content-title">Content Title</h3>
                    <button class="close-btn" onclick="closeContentViewer()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="content-preview" class="content-preview">
                        <!-- Content preview will be shown here -->
                    </div>
                    <div id="payment-section" class="payment-section">
                        <div class="price-options">
                            <div class="price-option">
                                <span class="price-label">View Price</span>
                                <span class="price-value" id="view-price">0 USDC</span>
                                <button id="pay-to-view" class="btn btn-primary">
                                    <i class="fas fa-eye"></i>
                                    Pay to View
                                </button>
                            </div>
                            <div class="price-option">
                                <span class="price-label">Ownership Price</span>
                                <span class="price-value" id="ownership-price">0 USDC</span>
                                <button id="pay-to-own" class="btn btn-primary">
                                    <i class="fas fa-crown"></i>
                                    Pay to Own
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/simple-payment.js"></script>
    <script>
        // Simple D.R.I.P. App
        class SimpleDRIPApp {
            constructor() {
                this.currentSection = 'marketplace';
                this.currentContent = null;
                this.init();
            }

            async init() {
                console.log('Initializing Simple D.R.I.P. App...');
                this.setupEventListeners();
                await this.loadContent();
                this.updateStats();
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = e.target.getAttribute('href').substring(1);
                        this.showSection(section);
                    });
                });

                // Wallet connection
                document.getElementById('connect-wallet-btn').addEventListener('click', () => {
                    simplePayment.connectWallet();
                });

                document.getElementById('disconnect-wallet').addEventListener('click', () => {
                    simplePayment.disconnectWallet();
                });

                // Upload form
                document.getElementById('upload-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleUpload();
                });

                // Payment buttons
                document.getElementById('pay-to-view').addEventListener('click', () => {
                    this.processPayment('view');
                });

                document.getElementById('pay-to-own').addEventListener('click', () => {
                    this.processPayment('own');
                });
            }

            showSection(section) {
                // Hide all sections
                document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
                
                // Show selected section
                document.getElementById(section).style.display = 'block';
                
                // Update navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                document.querySelector(`[href="#${section}"]`).classList.add('active');
                
                this.currentSection = section;
            }

            async loadContent() {
                const contentList = simplePayment.getContentList();
                const contentGrid = document.getElementById('content-grid');
                
                if (contentList.length === 0) {
                    contentGrid.innerHTML = '<p>No content available yet. Upload some content to get started!</p>';
                    return;
                }

                contentGrid.innerHTML = contentList.map(content => `
                    <div class="content-card" onclick="app.viewContent('${content.id}')">
                        <div class="content-card-image">
                            <img src="${content.thumbnail}" alt="${content.title}">
                        </div>
                        <div class="content-card-content">
                            <h3>${content.title}</h3>
                            <p>${content.description}</p>
                            <div class="content-card-meta">
                                <span class="content-card-type">${content.contentType}</span>
                                <span class="content-card-price">${content.viewPrice} USDC</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            viewContent(contentId) {
                const content = simplePayment.getContentList().find(c => c.id === contentId);
                if (!content) return;

                this.currentContent = content;
                
                // Check if user has access
                if (simplePayment.hasContentAccess(contentId, simplePayment.address)) {
                    this.showContentAccess();
                } else {
                    this.showPaymentOptions();
                }

                // Update modal content
                document.getElementById('content-title').textContent = content.title;
                document.getElementById('view-price').textContent = `${content.viewPrice} USDC`;
                document.getElementById('ownership-price').textContent = `${content.ownershipPrice} USDC`;
                
                // Show modal
                document.getElementById('content-viewer-modal').classList.add('active');
            }

            showContentAccess() {
                document.getElementById('payment-section').style.display = 'none';
                document.getElementById('content-preview').innerHTML = `
                    <div class="access-granted">
                        <h3>âœ… Access Granted!</h3>
                        <p>You can now view this content.</p>
                    </div>
                `;
            }

            showPaymentOptions() {
                document.getElementById('payment-section').style.display = 'block';
                document.getElementById('content-preview').innerHTML = `
                    <div class="payment-required">
                        <h3>ðŸ”’ Content Locked</h3>
                        <p>Pay to unlock this content.</p>
                    </div>
                `;
            }

            async processPayment(type) {
                if (!simplePayment.isConnected) {
                    alert('Please connect your wallet first');
                    return;
                }

                const content = this.currentContent;
                const amount = type === 'view' ? content.viewPrice : content.ownershipPrice;
                
                try {
                    await simplePayment.processPayment(content.id, amount, content.creator);
                    this.showContentAccess();
                } catch (error) {
                    console.error('Payment failed:', error);
                }
            }

            async handleUpload() {
                if (!simplePayment.isConnected) {
                    alert('Please connect your wallet first');
                    return;
                }

                const formData = {
                    title: document.getElementById('content-title-input').value,
                    description: document.getElementById('content-description-input').value,
                    contentType: document.getElementById('content-type-select').value,
                    viewPrice: parseFloat(document.getElementById('view-price-input').value),
                    ownershipPrice: parseFloat(document.getElementById('ownership-price-input').value)
                };

                try {
                    await simplePayment.uploadContent(formData);
                    document.getElementById('upload-form').reset();
                    await this.loadContent();
                    this.updateStats();
                } catch (error) {
                    console.error('Upload failed:', error);
                }
            }

            updateStats() {
                const stats = simplePayment.getPlatformStats();
                document.getElementById('total-content').textContent = stats.totalContent;
                document.getElementById('total-revenue').textContent = stats.totalRevenue.toFixed(2);
                document.getElementById('platform-revenue').textContent = `${stats.totalRevenue.toFixed(2)} USDC`;
                document.getElementById('paid-creators').textContent = `${stats.totalPaidToCreators.toFixed(2)} USDC`;
                document.getElementById('pending-payments').textContent = stats.pendingPayments;
            }

            closeContentViewer() {
                document.getElementById('content-viewer-modal').classList.remove('active');
                this.currentContent = null;
            }
        }

        // Initialize app
        const app = new SimpleDRIPApp();
    </script>
</body>
</html>
