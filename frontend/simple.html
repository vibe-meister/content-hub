<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D.R.I.P. - Decentralized Revenue In Publishing</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <span>ðŸ’§ D.R.I.P.</span>
            </div>
            <div class="nav-actions">
                <button id="connect-wallet-btn" class="btn btn-primary">
                    <i class="fas fa-wallet"></i>
                    Connect Wallet
                </button>
                <div id="wallet-info" style="display: none;">
                    <span id="wallet-address">Connected</span>
                    <button id="disconnect-btn" class="btn btn-outline btn-sm">Disconnect</button>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1 class="hero-title">
                    <span class="gradient-text">Decentralized Revenue In Publishing</span>
                </h1>
                <p class="hero-description">
                    Upload, share, and monetize your content. Set your prices, earn from views, and build your audience. Anonymously And On Chain. D.R.I.P with USDC
                </p>
                <div class="hero-stats">
                    <div class="stat">
                        <span class="stat-number">0</span>
                        <span class="stat-label">Content</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">0</span>
                        <span class="stat-label">USDC Earned</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">0</span>
                        <span class="stat-label">Creators</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Content Grid -->
        <section class="content-section">
            <div class="section-header">
                <h2>Featured Content</h2>
            </div>
            <div class="content-grid" id="content-grid">
                <!-- Content will be loaded here -->
            </div>
        </section>

        <!-- Upload Section -->
        <section class="upload-section">
            <div class="section-header">
                <h2>Upload Content</h2>
            </div>
            <div class="upload-form">
                <input type="text" id="content-title" placeholder="Content Title" required>
                <textarea id="content-description" placeholder="Description" required></textarea>
                <div class="price-inputs">
                    <input type="number" id="view-price" placeholder="View Price (USDC)" step="0.1" required>
                    <input type="number" id="ownership-price" placeholder="Ownership Price (USDC)" step="0.1" required>
                </div>
                <button id="upload-btn" class="btn btn-primary">Upload Content</button>
            </div>
        </section>

        <!-- Content Modal -->
        <div id="content-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-title">Content Title</h3>
                    <button class="close-btn" onclick="closeModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="content-preview">
                        <p>Content preview will be shown here after payment.</p>
                    </div>
                    <div id="payment-section">
                        <div class="payment-options">
                            <div class="payment-option">
                                <span>View Price: <span id="modal-view-price">0</span> USDC</span>
                                <button id="pay-view" class="btn btn-primary">Pay to View</button>
                            </div>
                            <div class="payment-option">
                                <span>Ownership Price: <span id="modal-ownership-price">0</span> USDC</span>
                                <button id="pay-own" class="btn btn-primary">Pay to Own</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple D.R.I.P. - Minimal Version
        class SimpleDRIP {
            constructor() {
                this.wallet = null;
                this.isConnected = false;
                this.contentList = [];
                this.currentContent = null;
                this.platformWallet = '0x44edA89fdff579f5FB51E14253B67B557A00d16c'; // Your wallet
                this.platformFee = 5; // 5%
                
                this.init();
            }

            init() {
                this.loadContent();
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Connect wallet
                document.getElementById('connect-wallet-btn').addEventListener('click', () => {
                    this.connectWallet();
                });

                // Disconnect wallet
                document.getElementById('disconnect-btn').addEventListener('click', () => {
                    this.disconnectWallet();
                });

                // Upload content
                document.getElementById('upload-btn').addEventListener('click', () => {
                    this.uploadContent();
                });

                // Payment buttons
                document.getElementById('pay-view').addEventListener('click', () => {
                    this.processPayment('view');
                });

                document.getElementById('pay-own').addEventListener('click', () => {
                    this.processPayment('own');
                });
            }

            async connectWallet() {
                try {
                    if (typeof window.ethereum === 'undefined') {
                        alert('MetaMask is not installed!');
                        return;
                    }

                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    
                    const signer = provider.getSigner();
                    const address = await signer.getAddress();

                    this.wallet = { provider, signer, address };
                    this.isConnected = true;

                    // Update UI
                    document.getElementById('connect-wallet-btn').style.display = 'none';
                    document.getElementById('wallet-info').style.display = 'block';
                    document.getElementById('wallet-address').textContent = 
                        `Connected: ${address.substring(0, 6)}...${address.substring(address.length - 4)}`;

                    alert('Wallet connected successfully!');
                } catch (error) {
                    console.error('Connection failed:', error);
                    alert('Failed to connect wallet: ' + error.message);
                }
            }

            disconnectWallet() {
                this.wallet = null;
                this.isConnected = false;
                document.getElementById('connect-wallet-btn').style.display = 'block';
                document.getElementById('wallet-info').style.display = 'none';
                alert('Wallet disconnected.');
            }

            uploadContent() {
                if (!this.isConnected) {
                    alert('Please connect your wallet first');
                    return;
                }

                const title = document.getElementById('content-title').value;
                const description = document.getElementById('content-description').value;
                const viewPrice = parseFloat(document.getElementById('view-price').value);
                const ownershipPrice = parseFloat(document.getElementById('ownership-price').value);

                if (!title || !description || !viewPrice || !ownershipPrice) {
                    alert('Please fill in all fields');
                    return;
                }

                const content = {
                    id: 'content_' + Date.now(),
                    title,
                    description,
                    creator: this.wallet.address,
                    viewPrice,
                    ownershipPrice,
                    uploadDate: new Date(),
                    views: 0
                };

                this.contentList.unshift(content);
                this.saveContent();
                this.displayContent();
                this.clearForm();
                
                alert('Content uploaded successfully!');
            }

            displayContent() {
                const grid = document.getElementById('content-grid');
                if (this.contentList.length === 0) {
                    grid.innerHTML = '<p>No content available yet. Upload some content!</p>';
                    return;
                }

                grid.innerHTML = this.contentList.map(content => `
                    <div class="content-card" onclick="drip.viewContent('${content.id}')">
                        <div class="content-card-image">
                            <img src="https://via.placeholder.com/300x200/0d98ba/ffffff?text=${content.title}" alt="${content.title}">
                        </div>
                        <div class="content-card-content">
                            <h3>${content.title}</h3>
                            <p>${content.description}</p>
                            <div class="content-card-meta">
                                <span class="content-card-price">${content.viewPrice} USDC</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            viewContent(contentId) {
                const content = this.contentList.find(c => c.id === contentId);
                if (!content) return;

                this.currentContent = content;
                
                // Update modal
                document.getElementById('modal-title').textContent = content.title;
                document.getElementById('modal-view-price').textContent = content.viewPrice;
                document.getElementById('modal-ownership-price').textContent = content.ownershipPrice;
                
                // Check if user has access
                if (this.hasAccess(contentId)) {
                    this.showContent();
                } else {
                    this.showPayment();
                }

                document.getElementById('content-modal').style.display = 'block';
            }

            hasAccess(contentId) {
                const accessKey = `access_${contentId}_${this.wallet?.address}`;
                return localStorage.getItem(accessKey) === 'true';
            }

            grantAccess(contentId) {
                const accessKey = `access_${contentId}_${this.wallet.address}`;
                localStorage.setItem(accessKey, 'true');
            }

            showContent() {
                document.getElementById('payment-section').style.display = 'none';
                document.getElementById('content-preview').innerHTML = `
                    <div class="access-granted">
                        <h3>âœ… Access Granted!</h3>
                        <p>You can now view this content.</p>
                        <p><strong>Content:</strong> ${this.currentContent.description}</p>
                    </div>
                `;
            }

            showPayment() {
                document.getElementById('payment-section').style.display = 'block';
                document.getElementById('content-preview').innerHTML = `
                    <div class="payment-required">
                        <h3>ðŸ”’ Content Locked</h3>
                        <p>Pay to unlock this content.</p>
                    </div>
                `;
            }

            async processPayment(type) {
                if (!this.isConnected) {
                    alert('Please connect your wallet first');
                    return;
                }

                const content = this.currentContent;
                const amount = type === 'view' ? content.viewPrice : content.ownershipPrice;
                
                try {
                    // Simulate payment processing
                    alert(`Processing payment of ${amount} USDC...`);
                    
                    // In real implementation, you'd send USDC to your wallet
                    // For now, just simulate the payment
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Grant access
                    this.grantAccess(content.id);
                    this.showContent();
                    
                    // Update content views
                    content.views++;
                    this.saveContent();
                    
                    alert(`Payment successful! You now have access to this content.`);
                } catch (error) {
                    console.error('Payment failed:', error);
                    alert('Payment failed: ' + error.message);
                }
            }

            saveContent() {
                localStorage.setItem('drip_content', JSON.stringify(this.contentList));
            }

            loadContent() {
                const saved = localStorage.getItem('drip_content');
                if (saved) {
                    this.contentList = JSON.parse(saved);
                }
                this.displayContent();
            }

            clearForm() {
                document.getElementById('content-title').value = '';
                document.getElementById('content-description').value = '';
                document.getElementById('view-price').value = '';
                document.getElementById('ownership-price').value = '';
            }
        }

        // Initialize app
        const drip = new SimpleDRIP();

        function closeModal() {
            document.getElementById('content-modal').style.display = 'none';
        }
    </script>
</body>
</html>
